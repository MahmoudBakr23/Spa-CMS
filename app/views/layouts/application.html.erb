<!DOCTYPE html>
<html lang="<%= I18n.locale %>" dir="<%= I18n.locale == :ar ? 'rtl' : 'ltr' %>">
  <head>
    <title><%= content_for(:title) || t('app.name') %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    
    <!-- Bootstrap CSS for dropdown functionality -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <%= javascript_importmap_tags %>
    
    <!-- Bootstrap JS for dropdown functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>

  <body>
    <!-- Language switcher removed - using URL-based language switching (/en/admin vs /ar/admin) -->
    
    <!-- Flash Messages -->
    <% if notice %>
      <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin: 0;">
        <%= notice %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% end %>
    
    <% if alert %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert" style="margin: 0;">
        <%= alert %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% end %>
    
    <%= yield %>
    
    <!-- RTL Styles -->
    <% if I18n.locale == :ar %>
      <style>
        [dir="rtl"] {
          text-align: right;
        }
        
        [dir="rtl"] .language-switcher-header {
          right: auto;
          left: 10px;
        }
        
        /* RTL specific adjustments for ActiveAdmin */
        [dir="rtl"] #active_admin_content {
          direction: rtl;
        }
        
        [dir="rtl"] #sidebar {
          float: left;
          left: 0;
          right: auto;
        }
        
        [dir="rtl"] #main_content_wrapper {
          float: right;
          margin-left: 270px;
          margin-right: 0;
        }
        
        [dir="rtl"] #header {
          direction: rtl;
        }
        
        [dir="rtl"] #header #site_title {
          float: right;
        }
        
        [dir="rtl"] #header .utility_nav {
          float: left;
        }
        
        [dir="rtl"] .panel h3 {
          text-align: right;
        }
        
        [dir="rtl"] .index_table th,
        [dir="rtl"] .index_table td {
          text-align: right;
        }
        
        [dir="rtl"] .breadcrumb {
          direction: rtl;
        }
        
        [dir="rtl"] .formtastic .inputs ol li {
          direction: rtl;
        }
        
        [dir="rtl"] .formtastic label {
          float: right;
          text-align: right;
        }
        
        [dir="rtl"] .formtastic input,
        [dir="rtl"] .formtastic textarea,
        [dir="rtl"] .formtastic select {
          direction: rtl;
          text-align: right;
        }
        
        /* Language Switcher for ActiveAdmin */
        .language-switcher-admin-header {
          position: fixed;
          top: 10px;
          right: 10px;
          z-index: 9999;
          background: white;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 8px 12px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        [dir="rtl"] .language-switcher-admin-header {
          right: auto;
          left: 10px;
        }
        
        .language-switcher-admin-header a {
          color: #007cba;
          text-decoration: none;
          margin-left: 8px;
          padding: 4px 8px;
          border-radius: 3px;
          transition: background 0.2s ease;
        }
        
        .language-switcher-admin-header a:hover {
          background: #007cba;
          color: white;
        }
        
        [dir="rtl"] .language-switcher-admin-header a {
          margin-left: 0;
          margin-right: 8px;
        }
      </style>
    <% end %>
  </body>
</html>
